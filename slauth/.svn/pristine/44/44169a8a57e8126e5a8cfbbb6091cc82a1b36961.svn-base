"use strict";var fsp=require("fs-promise"),NEW_LINE_CHARACTERS=["\n","\r"];module.exports={read:function read(a,b){var c=function(a,b,c){return fsp.read(b,new Buffer(1),0,1,a.size-1-c).then(function(a){return String.fromCharCode(a[1][0])})};return new Promise(function(d,e){var f={stat:null,file:null};fsp.exists(a).then(function(a){if(!a)throw new Error("file does not exist")}).then(function(){var b=[fsp.stat(a).then(function(a){return f.stat=a}),fsp.open(a,"r").then(function(a){return f.file=a})];return b}).then(function(a){return Promise.all(a).then(function(){var a=0,e=0,g="",h=function(){return g.length>f.stat.size&&(g=g.substring(g.length-f.stat.size)),g.length>=f.stat.size||e>=b?(NEW_LINE_CHARACTERS.includes(g.substring(0,1))&&(g=g.substring(1)),fsp.close(f.file),d(g)):void c(f.stat,f.file,a).then(function(b){g=b+g,NEW_LINE_CHARACTERS.includes(b)&&1<g.length&&e++,a++}).then(h)};h()})}).catch(function(a){return null!==f.file&&fsp.close(f.file),e(a)})})}};